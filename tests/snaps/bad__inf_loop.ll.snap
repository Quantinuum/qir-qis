---
source: src/convert.rs
expression: qis_text.unwrap().to_string()
---
; ModuleID = 'qis_module'
source_filename = "tests/data/bad/inf_loop.ll"
target datalayout = "e-m:e-i8:8:32-i16:16:32-i64:64-i128:128-n32:64-S128"
target triple = "aarch64-unknown-linux-gnu"

%Qubit = type opaque

@qis_qs = private unnamed_addr global [1 x i64] zeroinitializer
@e_qalloc_fail = private constant [47 x i8] c".EXIT:INT:No more qubits available to allocate."
@gen_name = global [7 x i8] c"qir-qis", section ",generator"
@gen_version = global [5 x i8] c"0.0.0", section ",generator"

; Function Attrs: noreturn
define i64 @___user_qir_bad_loop() local_unnamed_addr #0 {
entry:
  %qalloc.i = tail call i64 @___qalloc()
  %is_fail.i = icmp eq i64 %qalloc.i, -1
  br i1 %is_fail.i, label %qalloc_fail.i, label %qir_qis.init_qubit.exit

qalloc_fail.i:                                    ; preds = %entry
  tail call void @panic(i32 1001, i8* getelementptr inbounds ([47 x i8], [47 x i8]* @e_qalloc_fail, i64 0, i64 0))
  unreachable

qir_qis.init_qubit.exit:                          ; preds = %entry
  tail call void @___reset(i64 %qalloc.i)
  store i64 %qalloc.i, i64* getelementptr inbounds ([1 x i64], [1 x i64]* @qis_qs, i64 0, i64 0), align 8
  br label %loop.i

loop.i:                                           ; preds = %loop.i, %qir_qis.init_qubit.exit
  br label %loop.i
}

; Function Attrs: nofree norecurse noreturn nosync nounwind readnone
define void @infinite_loop() local_unnamed_addr #1 {
entry:
  br label %loop

loop:                                             ; preds = %loop, %entry
  br label %loop
}

declare i64 @___qalloc() local_unnamed_addr

declare void @panic(i32, i8*) local_unnamed_addr

declare void @___reset(i64) local_unnamed_addr

; Function Attrs: mustprogress nofree norecurse nosync nounwind readonly willreturn
define i64 @qir_qis.load_qubit(%Qubit* %0) local_unnamed_addr #2 {
entry:
  %idx = ptrtoint %Qubit* %0 to i64
  %qbit_ptr = getelementptr [1 x i64], [1 x i64]* @qis_qs, i64 0, i64 %idx
  %qbit = load i64, i64* %qbit_ptr, align 8
  ret i64 %qbit
}

; Function Attrs: noreturn
define i64 @qmain(i64 %0) local_unnamed_addr #0 {
entry:
  tail call void @setup(i64 %0)
  %qalloc.i.i = tail call i64 @___qalloc()
  %is_fail.i.i = icmp eq i64 %qalloc.i.i, -1
  br i1 %is_fail.i.i, label %qalloc_fail.i.i, label %qir_qis.init_qubit.exit.i

qalloc_fail.i.i:                                  ; preds = %entry
  tail call void @panic(i32 1001, i8* getelementptr inbounds ([47 x i8], [47 x i8]* @e_qalloc_fail, i64 0, i64 0))
  unreachable

qir_qis.init_qubit.exit.i:                        ; preds = %entry
  tail call void @___reset(i64 %qalloc.i.i)
  store i64 %qalloc.i.i, i64* getelementptr inbounds ([1 x i64], [1 x i64]* @qis_qs, i64 0, i64 0), align 8
  br label %loop.i.i

loop.i.i:                                         ; preds = %loop.i.i, %qir_qis.init_qubit.exit.i
  br label %loop.i.i
}

declare void @setup(i64) local_unnamed_addr

attributes #0 = { noreturn }
attributes #1 = { nofree norecurse noreturn nosync nounwind readnone }
attributes #2 = { mustprogress nofree norecurse nosync nounwind readonly willreturn }

!llvm.module.flags = !{!0, !1, !2, !3, !4, !5}
!name = !{!6}

!0 = !{i32 1, !"qir_major_version", i32 1}
!1 = !{i32 7, !"qir_minor_version", i32 0}
!2 = !{i32 1, !"dynamic_qubit_management", i1 false}
!3 = !{i32 1, !"dynamic_result_management", i1 false}
!4 = !{i32 1, !"ir_functions", i1 true}
!5 = !{i32 1, !"backwards_branching", i2 -2}
!6 = !{!"mainlib"}
